<add allowDups="false">
    <doc>
        <field name="RecId">{{ doc['dpla.contributor_record_id'] }}-{{ geotag.anchor_start }}</field>

        <field name="dpla_contributor_record_id">{{ doc['dpla.contributor_record_id'] }}</field>
        <field name="dpla_dataset_id">{{ doc['dpla.dataset_id'] }}</field>
        <field name="dpla_date">{{ doc['dpla.date'] }}</field>
        <field name="dpla_id">{{ doc['dpla.id'] }}</field>
        <field name="dpla_oclc">{{ doc['dpla.oclc'] }}</field>

        {% for subject in doc['dpla.subject'] %}
        <field name="dpla_subject">{{ subject }}</field>
        {% endfor %}
        {% for creator in doc['dpla.creator'] %}
        <field name="dpla_creator">{{ creator }}</field>
        {% endfor %}
        {% for description in doc['dpla.description'] %}
        <field name="dpla_description">{{ description }}</field>
        {% endfor %}
        <field name="dpla_language">{{ doc['dpla.language'] }}</field>
        <field name="dpla_format">{{ doc['dpla.format'] }}</field>

        <field name="dpla_title">{{ doc['dpla.title'] }}</field>
        <field name="dpla_publisher">{{ doc['dpla.publisher'] | clean }}</field>
        <field name="dpla_isbn">{{ doc['dpla.isbn'] }}</field>
        <field name="dpla_lccn">{{ doc['dpla.lccn'] }}</field>
        <field name="dpla_resource_type">{{ doc['dpla.resource_type'] }}</field>
        <field name="dpla_keyword"></field>
        <field name="dpla_contributor">{{ doc['dpla.contributor'] }}</field>

            {% for field in marc_fields %}{% if doc[field].first %}{% for field_value in doc[field] %}<field name="{{ field }}">{{ field_value | clean }}</field>
        {% endfor %}{% elsif doc[field] %}<field name="{{ field }}">{{ doc[field] | clean }}</field>
            {% endif %}{% endfor %}

        <field name="Match_Confidence">{{ geotag.confidence }}</field>

        {% for disjunct in geotag.disjuncts %}
        <field name="Disjunct_Weight{{ forloop.index }}">{{ disjunct.weight }}</field>
        <field name="Conjunct_Name{{ forloop.index }}">{{ disjunct.name }}</field>
        <field name="Conjunct_Country{{ forloop.index }}">{{ disjunct.country }}</field>
        <field name="Conjunct_CountryName{{ forloop.index }}">{{ disjunct.country_name }}</field>
        <field name="Conjunct_CountryConfidence{{ forloop.index }}">{{ disjunct.country_confidence }}</field>
        <field name="Conjunct_Province{{ forloop.index }}">{{ disjunct.province }}</field>
        <field name="Conjunct_ProvinceName{{ forloop.index }}">{{ disjunct.province_name }}</field>
        <field name="Conjunct_ProvinceConfidence{{ forloop.index }}">{{ disjunct.province_confidence }}</field>
        <field name="Conjunct_Latitude{{ forloop.index }}">{{ disjunct.latitude }}</field>
        <field name="Conjunct_Longitude{{ forloop.index }}">{{ disjunct.longitude }}</field>
        {% endfor %}

        <field name="MarcText">{{ json }}</field>
    </doc>
</add>
